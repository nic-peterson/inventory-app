<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Books - Bookstore Inventory</title>
    <link rel="stylesheet" href="/css/tailwind.css" />
  </head>
  <body class="bg-secondary text-gray-900">
    <%- include('../partials/header') %> <%- include('../partials/nav') %>
    <main class="p-4">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold">Books</h2>

        <a
          href="/books/add"
          class="bg-accent text-white px-4 py-2 rounded hover:bg-accent-dark inline-flex items-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 mr-2"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
              clip-rule="evenodd"
            />
          </svg>
          Add New Book
        </a>
      </div>
      <div class="mb-4">
        <input
          type="text"
          id="searchInput"
          placeholder="Search books..."
          class="w-full p-2 border rounded"
        />
      </div>
      <table class="min-w-full bg-white shadow-md rounded">
        <thead class="bg-gray-100">
          <tr>
            <th class="p-3 text-left">Title</th>
            <th class="p-3 text-left">Authors</th>
            <th class="p-3 text-left">Genre</th>
            <th class="p-3 text-left">Quantity</th>
            <th class="p-3 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% books.forEach(book => { %>
          <tr class="border-t">
            <td class="p-3"><%= book.title %></td>
            <td class="p-3"><%= book.authors.join(', ') %></td>
            <td class="p-3"><%= book.genre_name %></td>
            <td class="p-3"><%= book.quantity %></td>
            <td class="p-3 text-center space-x-2">
              <a
                href="/books/<%= book.id %>"
                class="text-blue-600 hover:underline"
                >View</a
              >
              <a
                href="/books/<%= book.id %>/edit"
                class="text-green-600 hover:underline"
                >Edit</a
              >
              <button
                data-book-id="<%= book.id %>"
                class="delete-book text-red-600 hover:underline cursor-pointer"
              >
                Delete
              </button>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </main>
    <script>
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("delete-book")) {
          const bookId = e.target.dataset.bookId;
          deleteBook(bookId);
        }
      });

      async function deleteBook(id) {
        if (confirm("Are you sure you want to delete this book?")) {
          try {
            const response = await fetch(`/books/${id}`, {
              method: "DELETE",
            });
            if (response.ok) {
              window.location.reload();
            } else {
              alert("Failed to delete book");
            }
          } catch (error) {
            console.error("Error:", error);
            alert("Failed to delete book");
          }
        }
      }
    </script>
  </body>
</html>
